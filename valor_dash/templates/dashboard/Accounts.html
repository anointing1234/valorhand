{% extends "layout/base.html" %} 
{% load static %}
{% block contents %}


<style>
  .sidebar_right {
    position: fixed; /* Fixed position */
    top: 0;
    right: -300px; /* Initially hide offscreen */
    width: 300px; /* Width of the sidebar */
    height: 100%; /* Full height */
    background-color: white; /* Background color */
    box-shadow: -2px 0 5px rgba(0, 0, 0, 0.5); /* Shadow effect */
    border-radius: 10px; /* Rounded corners */
    transition: right 0.3s ease; /* Transition effect */
    z-index: 1050; /* Ensure it is above other content */
    overflow-y: auto; /* Enable vertical scrolling if content exceeds height */
}
.contact-info p {
  margin: 5px 0; /* Space between contact info lines */
}

.contact-info i {
  margin-right: 10px; /* Space between icon and text */
  color: #007bff; /* Change icon color to match your theme */
}

.sidebar_right.active {
    right: 0; /* Show sidebar when active */
}

.close-btn {
    cursor: pointer; /* Pointer cursor for close button */
    font-size: 2rem; /* Larger close button */
    color: #000; /* Close button color */
    position: absolute; /* Positioning */
    top: 20px; /* Distance from the top */
    right: 20px; /* Distance from the right */
    z-index: 1060; /* Higher z-index to ensure it's on top */
}

/* Additional styles for forms inside the sidebar */
.forms-sample {
    padding: 20px; /* Add some padding for the form */
}

.form-group {
    margin-bottom: 15px; /* Spacing between form groups */
}

.btn {
    margin-top: 10px; /* Space above buttons */
}

/* Add media query for responsiveness */
@media (max-width: 768px) {
    .sidebar_right {
        width: 100%; /* Adjust width for smaller screens */
        right: -100%; /* Hide completely offscreen */
    }

    .sidebar_right.active {
        right: 0; /* Show sidebar when active */
    }
}

.close-btn {
    cursor: pointer; /* Pointer cursor for close button */
    font-size: 2rem; /* Larger close button */
    color: #000; /* Close button color */
    position: absolute; /* Positioning */
    top: 20px; /* Distance from the top */
    right: 20px; /* Distance from the right */
    z-index: 1060; /* Higher z-index to ensure it's on top */
}

/* Additional styles for forms inside the sidebar */
.forms-sample {
    padding: 20px; /* Add some padding for the form */
}

.form-group {
    margin-bottom: 15px; /* Spacing between form groups */
}

.btn {
    margin-top: 10px; /* Space above buttons */
}

/* Add media query for responsiveness if needed */
@media (max-width: 768px) {
    .sidebar_right {
        width: 100%; /* Adjust width for smaller screens */
    }
}

  
    .custom-card {
        height: 400px;
    }
    .profile-pic {
        height: 90px;
        width: 90px;
    }
    .profile-section {
        opacity: 1;
        transition: opacity 0.1s ease-in-out;
    }
    .profile-section.d-none {
        opacity: 0;
        pointer-events: none;
    }
    .but {
        margin-left: 2cm;
    }
    .profile-section {
        margin-top: 2cm;
    }
    .profile-pic {
        width: 100px; /* Example size, adjust as needed */
        height: 100px; /* Example size, adjust as needed */
        object-fit: cover;
        object-position: center;
        border-radius: 50%; /* Ensures the image is a circle */
    }
    .position-relative{
        margin-left: 20cm; 
    }
    .switch-container {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
  }

 
  /* Gradient Background */
.bg-gradient {
  background: linear-gradient(135deg, #007bff, #6610f2);
  color: white;
  border-radius: 10px;
}

/* Card Styles */
.card {
  border-radius: 15px;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.profile-pic {
  border: 4px solid #ffffff; /* White border for contrast against gradient */
  object-fit: cover;
}

/* Balance Card Styling */
.balance-card {
  background-color: #ffffff;
  border-radius: 12px;
  padding: 20px;
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.balance-card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}

/* Gradient Text */
.text-gradient {
  background: linear-gradient(to right, #007bff, #6610f2);
  -webkit-background-clip: text;
  color: transparent;
}

/* Typography */
h4 {
  font-weight: 600;
  color: white;
}

h5 {
  font-weight: 500;
}

.switch {
  font-size: 1.4rem;
  color: #6610f2; /* Purple for main balance text */
}

p.text-light {
  margin-top: -10px;
  color: #e0e0e0;
}

/* General Styles */
.container-fluid {
  background-color: transparent;
  padding: 20px;
}

.shadow-sm {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.shadow-lg {
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
}


/* Button Custom Styling */
.btn-custom {
    padding: 12px 20px;
    font-size: 1rem;
    font-weight: 500;
    border-radius: 8px;
    transition: all 0.3s ease-in-out;
    text-align: left;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
}

.btn-custom i {
    margin-right: 10px;
    font-size: 1.2rem;
}

/* Hover Effects */
.btn-custom:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
}

.btn-custom.btn-warning {
    background-color: #ffc107;
    color: #fff;
}

.btn-custom.btn-success {
    background-color: #28a745;
    color: #fff;
}

.btn-custom.btn-danger {
    background-color: #dc3545;
    color: #fff;
}

.btn-custom.btn-block {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.btn-custom-outline {
    background-color: transparent;
    border: 2px solid #007bff;
    color: #007bff;
}

/* Global Button Effects */
.btn {
    transition: background-color 0.3s ease, color 0.3s ease;
}

/* Button Icon Styling */
.btn-custom i {
    font-size: 1.2rem;
}

/* Card Styling */
.card {
    background-color: rgba(255, 255, 255, 0.8); /* Semi-transparent background for a sleek look */
    border-radius: 12px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.card-body {
    padding: 20px;
    text-align: center;
}

/* Margin and Padding */
.d-grid {
    gap: 20px;
}


</style>
    






      
      <!-- partial -->
      <div class="main-panel  ">
        <div class="content-wrapper">
            {% if not is_verified %}
            <div class="alert alert-danger" role="alert">
                Please verify your email in other to carry out transactions <a href="{% url 'accounts' %}" class="alert-link">CLick to verify</a>
            </div>
                {% endif %}
          <div class="page-header">
            <h3 class="page-title">
              My Account
            </h3>
          </div>
          
          <div class="row">
            <div class="col-md-6 grid-margin stretch-card">
                <div class="card bg-gradient rounded-lg border-0 shadow-lg">
                  <div class="card-body">
                    <!-- Profile Information Section -->
                    <div class="container-fluid mt-5 d-flex justify-content-center">
                      <div class="container text-center">
                        <!-- Profile Picture -->
                        <img src="{% static 'images/profile_odj.jpg' %}" class="rounded-circle border border-2 border-white profile-pic" alt="Profile Image" width="150" height="150"/>
                        <!-- User Details -->
                        <h4 class="mt-3 text-white">{{ request.user.username }}</h4>
                        <p class="text-light">{{ request.user.email }}</p>
                      </div>
                    </div>
              
                    <!-- Balance Section -->
                    <div class="container-fluid mt-5">
                      <div class="row text-center">
                        <!-- Main Balance -->
                        <div class="col-md-6 col-sm-12 mb-4">
                          <div class="balance-card bg-white p-4 rounded shadow-sm d-flex justify-content-center flex-column">
                            <h5 class="text-gradient mb-2">Main Balance</h5>
                            <h5 class="switch">${{ formatted_Main_balance }}</h5>
                          </div>
                        </div>
                        <!-- Total Savings -->
                        <div class="col-md-6 col-sm-12 mb-4">
                          <div class="balance-card bg-white p-4 rounded shadow-sm d-flex justify-content-center flex-column">
                            <h5 class="text-gradient mb-2">Total Savings</h5>
                            <h5 class="switch">${{ formatted_total_savings }}</h5>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-6 grid-margin stretch-card">
                <div class="card bg-transparent border-0">
                    <div class="card-body p-4">
                        <!-- Button List Container -->
                        <div class="d-grid gap-3 mt-5">
                            <!-- My Account Settings Button -->
                            <a href="#" class="btn btn-custom btn-block" onclick="openSidebar('accountSettings')" role="button">
                                <i class="fa fa-cog me-2"></i>My Account Settings
                            </a>
            
                            <!-- Verify your email Button -->
                            {% if not is_verified %}
                            <a href="#" class="btn btn-custom btn-warning btn-block" onclick="openSidebar('verifyEmail')" role="button">
                                <i class="fa fa-envelope me-2"></i>Verify Your Email
                            </a>
                            {% else %}
                            <a href="#" class="btn btn-custom btn-success btn-block" role="button">
                                <i class="fa fa-check-circle me-2"></i>Email Verified
                            </a>
                            {% endif %}
            
                            <!-- Deposit Funds Button -->
                            <a href="{% url 'Transactions' %}" class="btn btn-custom btn-block" role="button">
                                <i class="fa fa-money-bill me-2"></i>Deposit Funds
                            </a>
            
                            <!-- Withdraw Funds Button -->
                            <a href="{% url 'Transactions' %}" class="btn btn-custom btn-block" role="button">
                                <i class="fa fa-wallet me-2"></i>Withdraw Funds
                            </a>
            
                            <!-- Contact Us Button -->
                            <a href="#" class="btn btn-custom btn-block" onclick="openSidebar('contactUs')" role="button">
                                <i class="fa fa-envelope-open-text me-2"></i>Contact Us
                            </a>
            
                            <!-- Log Out Button -->
                            <a href="{% url 'logout' %}" class="btn btn-custom btn-danger btn-block" role="button">
                                <i class="fa fa-sign-out-alt me-2"></i>Log Out
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="sidebar_accountSettings" class="sidebar_right py-5" aria-hidden="true">
                  <span class="close-btn" onclick="closeSidebar('accountSettings')">&times;</span>
                <div class="container ">  <h4 class="mt-5">My Account Settings</h4>
                  <p>Update your account information here...</p>
                  </div>
                  <div class="col-12 grid-margin stretch-card"> <!-- Changed col-md-12 to col-12 for full width -->
                      <div class="card">
                          <div class="card-body">
                            <form id="accountSettingsForm" class="forms-sample">
                                {% csrf_token %}
                                <div class="form-group">
                                    <label for="exampleInputUsername1">Username</label>
                                    <input type="text" name="username" class="form-control" id="exampleInputUsername1" placeholder="Username" value="{{ request.user.username }}" required>
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputCountry">Country</label>
                                    <input type="text" name="country" class="form-control" id="exampleInputCountry" placeholder="Country" value="{{ request.user.country }}" required>
                                </div>
                                <div class="form-group">
                                    <label for="exampleInputPhone">Telephone</label>
                                    <input type="text" name="phone" class="form-control" id="exampleInputPhone" placeholder="Telephone" value="{{ request.user.phone }}" required>
                                </div>
                                <button type="submit" class="btn btn-primary mr-2">Save</button>
                                <button type="button" class="btn btn-light" onclick="closeSidebar('accountSettings')">Cancel</button>
                            </form>
                            
                          </div>
                      </div>
                  </div>

              </div>
     
              <!-- HTML Structure for Email Verification -->
               
<div id="sidebar_verifyEmail" class="sidebar_right py-5" aria-hidden="true">
    <span class="close-btn" onclick="closeSidebar('verifyEmail')">&times;</span>
    <div class="container">
        <h4 class="mt-5">Email Verification</h4>
        <p>Request a verification code to your email.</p>
    </div>
    <div class="col-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <form id="sendVerificationCodeForm" onsubmit="return sendVerificationCode(event);">
                    <div class="form-group">
                        <label for="verificationEmail">Email address</label>
                        <input type="email" class="form-control" id="verificationEmail" placeholder="Email" required>
                    </div>
                    <button type="submit" class="btn btn-primary mr-2">Send Code</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Verification Code Section -->
    <div class="col-12 grid-margin stretch-card mt-3" id="verifyCodeSection" style="display:none;">
        <div class="card">
            <div class="card-body">
                <form id="verifyCodeForm" onsubmit="return verifyCode(event);">
                    <div class="form-group">
                        <label for="verificationCode">Verification Code</label>
                        <input type="text" class="form-control" id="verificationCode" placeholder="Enter verification code" required>
                    </div>
                    <button type="submit" class="btn btn-primary mr-2">Verify</button>
                </form>
            </div>
        </div>
    </div>
</div>


</div>
<div id="sidebar_contactUs" class="sidebar_right py-5" aria-hidden="true">
  <span class="close-btn" onclick="closeSidebar('contactUs')">&times;</span>
  <div class="container mt-2">
      <h3 class="mt-5 mb-2">Contact Us</h3>
      <p>If you have any questions, feel free to reach out!</p>

      <div class="contact-info">
          <p>
              <i class="fas fa-map-marker-alt"></i> 
              <strong>Address:</strong> 123 6th St. Melbourne, FL 32904
          </p>
          <p>
              <i class="fas fa-phone-alt"></i> 
              <strong>Phone:</strong> (888) 123-4567
          </p>
          <p>
              <i class="fas fa-envelope"></i> 
              <strong>Email:</strong> 
              <a href="mailto:info@example.com">info@example.com</a>
          </p>
      </div>
  </div>
</div>


              
          <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.11.6/umd/popper.min.js"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/js/bootstrap.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


          <script>
            document.getElementById('accountSettingsForm').addEventListener('submit', async function(event) {
                event.preventDefault();  // Prevent the default form submission
        
                const formData = new FormData(this);
        
                try {
                    const response = await fetch("{% url 'account_settings' %}", {  // Use the URL defined in urls.py
                        method: 'POST',
                        body: formData,
                        headers: {
                            'X-Requested-With': 'XMLHttpRequest'  // Indicate that this is an AJAX request
                        }
                    });
        
                    if (!response.ok) {
                        const data = await response.json();
                        const errors = data.errors; // Get errors if any
                        let errorMessage = '';
        
                        // Collect all error messages
                        for (const key in errors) {
                            errorMessage += `${errors[key]}<br>`;
                        }
        
                        // Display error message using SweetAlert
                        Swal.fire({
                            icon: 'error',
                            title: 'Oops...',
                            html: errorMessage,
                            confirmButtonText: 'Okay'
                        });
                    } else {
                        // Handle success
                        const successMessage = await response.json();
                        
                        // Show success message using SweetAlert
                        Swal.fire({
                            icon: 'success',
                            title: 'Account updated successfully!',
                            text: successMessage.message, // Adjust according to your backend response
                            confirmButtonText: 'Okay'
                        }).then(() => {
                            // Optionally, you can refresh the page or redirect the user
                            location.reload(); // Reloads the page to reflect changes
                        });
                    }
                } catch (error) {
                    console.error('Error:', error);
                    // Handle unexpected errors
                    Swal.fire({
                        icon: 'error',
                        title: 'Error',
                        text: 'An unexpected error occurred. Please try again later.',
                        confirmButtonText: 'Okay'
                    });
                }
            });
        </script>
        



          <script>
            function sendVerificationCode(event) {
                event.preventDefault(); // Prevent the form from submitting normally
            
                const email = document.getElementById('verificationEmail').value;
            
                // AJAX request to send verification code
                fetch('{% url "send_verification_code" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',  // Include CSRF token
                    },
                    body: JSON.stringify({ email: email }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: data.message,
                        });
                        // Show the verification code input form
                        document.getElementById('verifyCodeSection').style.display = 'block';
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: data.message,
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Something went wrong. Please try again.',
                    });
                });
            }
            
            function verifyCode(event) {
                event.preventDefault(); // Prevent the form from submitting normally
            
                const email = document.getElementById('verificationEmail').value;
                const code = document.getElementById('verificationCode').value;
            
                // AJAX request to verify the code
                fetch('{% url "verify_code" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',  // Include CSRF token
                    },
                    body: JSON.stringify({ email: email, code: code }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: data.message,
                        }).then(() => {
                            // Optionally, you can refresh the page or redirect the user
                            location.reload(); // Reloads the page to reflect changes
                        }); 
                    } else {
                        Swal.fire({
                            icon: 'error',
                            title: 'Error!',
                            text: data.message,
                        });
                    }
                })
                .catch(error => {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: 'Something went wrong. Please try again.',
                    });
                });
            }
            </script>




    

  
    


  

{% endblock contents %}
